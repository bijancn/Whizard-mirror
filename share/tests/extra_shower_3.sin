!!! Process: Generic tests of Whizard+Shower at ILC 500 GeV
!!! Reported by: Mikael Berggren on 2015-06-21
!!! Purpose: Try to catch all possible misbehaviors in the matrix of
!!!          options

model = SM_CKM
?logging = true
?openmp_logging = false
?vis_history = false
?integration_timer = false
openmp_num_threads = 1
sample_format = debug
?debug_decay = false
?debug_process = false
?debug_verbose = false
?write_raw = false
seed = 0

ms = 0
mc = 0
!! issue with mb, flavour-sums, and whizard PS: Make correct choice here !
!mb = 0
me = 0
!mmu = 0.10566
!mH = 2000.
!wH = 10.
alphas = 1.e-6

alias bq = b:B

alias electrons = e1:E1
alias mus = e2:E2
alias taus = e3:E3

alias nu_es = n1:N1
alias nu_mus = n2:N2
alias nu_taus = n3:N3

alias quark = u:d:s:c:b:U:D:S:C:B
alias quark_notb = u:d:s:c:U:D:S:C
alias up_type_q = u:c:U:C
alias down_type_q = d:s:b:D:S:B
alias down_type_q_notb = d:s:D:S

alias lepton = e1:e2:e3:E1:E2:E3
alias not_electron = e2:e3:E2:E3

alias neutrino = n1:n2:n3:N1:N2:N3

$omega_flags =  "-model:constant_width"
# Z leptonic
!process extra_shower_3_z_bhabhaA = e1,E1 => electrons, electrons, A
process extra_shower_3_z_tau  = e1,E1 => taus, taus
process extra_shower_3_z_nu = e1,E1 => neutrino, neutrino

# Z hadronic
process extra_shower_3_z_hadro   = e1,E1 => quark_notb, quark_notb
process extra_shower_3_z_hadroB  = e1,E1 => bq, bq

# Z to bosons
# process ee_zz = e1,E1 =>  Z,Z
# process ee_az = e1,E1 =>  A,Z
# process ee_aa = e1,E1 =>  A,A
# process ee_zh = e1,E1 =>  H,Z

# ZZ/WW mix
process extra_shower_3_udud   = e1,E1 => quark_notb, quark_notb, quark_notb, quark_notb

# WW : qq l nu
#process extra_shower_3_ww_sl0tauq   =   e1,E1 =>  up_type_q,down_type_q,tau,neutrino
#process extra_shower_3_ww_sl0muq    =   e1,E1 =>  up_type_q,down_type_q,mu,neutrino
#
process extra_shower_3_eett = e1, E1 => t, tbar
process extra_shower_3_t_dec = t => Wp, b
process extra_shower_3_tb_dec = tbar => Wm, bbar
process extra_shower_3_Wp_dec = Wp => E2, n2
process extra_shower_3_Wm_dec_nb = Wm => up_type_q,down_type_q_notb
#
unstable t (extra_shower_3_t_dec)
unstable Wp (extra_shower_3_Wp_dec)
unstable tbar (extra_shower_3_tb_dec)
unstable Wm (extra_shower_3_Wm_dec_nb)

!compile
sqrts = 500 GeV
iterations = 5:50000:"gw", 5:50000

cuts = all Pt > 5 GeV  and Theta > 10 degree and Theta < 170 degree [lepton:lepton]
n_events = 10000
?keep_remnants = true
?keep_beams = true
?hadronization_active = true
?ps_fsr_active = true
ps_max_n_flavors = 5
ps_mass_cutoff = 1
ps_fsr_lambda = 0.29
! OPAL tune:
$ps_PYTHIA_PYGIVE = "PMAS(11,1)=0."
!$ps_PYTHIA_PYGIVE = "MSTJ(28)=0; PMAS(25,1)=120.; PMAS(25,2)=0.3605E-02; MSTJ(41)=2; MSTU(22)=2000; PARJ(21)=0.40000; PARJ(41)=0.11000; PARJ(42)=0.52000; PARJ(81)=0.25000; PARJ(82)=1.90000; MSTJ(11)=3; PARJ(54)=-0.03100; PARJ(55)=-0.00200; PARJ(1)=0.08500; PARJ(3)=0.45000; PARJ(4)=0.02500; PARJ(2)=0.31000; PARJ(11)=0.60000; PARJ(12)=0.40000; PARJ(13)=0.72000; PARJ(14)=0.43000; PARJ(15)=0.08000; PARJ(16)=0.08000; PARJ(17)=0.17000;    MSTP(3)=1;MSTP(71)=1"

!!>>   MSTP(125)=2 mean full pythia output, default means reduced output. Check both

!>> verfify all combinations
beams = e1, E1
beams = e1, E1 => isr
beams = e1, E1  => circe1
beams = e1, E1  => circe2
beams = e1, E1  => circe1 => isr
beams = e1, E1  => circe2 => isr
$circe2_file="ilc500.circe"
$circe2_design="ILC"
?circe2_polarized = false
beams_pol_density = @(-1),@(1)
beams_pol_fraction = 1.0,1.0
isr_alpha = 0.0072993
isr_mass = 0.000511

!>> check each
!simulate (extra_shower_3_z_bhabhaA)
integrate (extra_shower_3_z_tau)
scan string $meth = ("PYTHIA6", "WHIZARD") {
  $shower_method = $meth
  $sample = "extra_shower_3_z_tau_" & $shower_method
  simulate (extra_shower_3_z_tau)
  show (integral(extra_shower_3_z_tau))
  show (error(extra_shower_3_z_tau))
}
!simulate (extra_shower_3_z_nu)
!simulate (extra_shower_3_z_hadro)
!simulate (extra_shower_3_udud)
!simulate (extra_shower_3_eett)
! Try nondefault b-mass
!simulate (extra_shower_3_z_hadroB)
