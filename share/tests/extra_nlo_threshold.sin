# SINDARIN file for WHIZARD self test
# Input file for testing user defined amplitudes

?logging = true
?openmp_logging = false
?vis_history = false
?integration_timer = false

!!! Tests should be run single-threaded
openmp_num_threads = 1

model = SM_tt_threshold
sqrts = 400 GeV
sqrtsmin = sqrts - 5 GeV
sqrtsmax = sqrts + 5 GeV
sqrtsstepsize = 0.1 GeV

mZ = 91.188
mW = 80.419
mb = 4.2
alphas = 0.118 ! (Z pole, NLL running to mu_h)
alpha_em_i = 125.924 ! (not running)
m1S = 172.0
scale = m1S
mpole_fixed = 1

nloop  = 1 # NLL
sh     = 1.
sf     = 1.
Vtb    = 1.

me = 0
iterations = 1:10000
iterations = 1:1000

$method = "threshold"
$born_me_method = "threshold"
$loop_me_method = "threshold"
$correlation_me_method = "threshold"
$real_tree_me_method = "threshold"
alpha_power = 4
alphas_power = 0

FF = 10 # FF = 0
offshell_strategy = -3
seed = 0
process extra_nlo_threshold_p1 = e1, E1 => Wp, Wm, b, B {$restrictions = "3+5~t && 4+6~tbar"}
integrate (extra_nlo_threshold_p1)
expect (integral (extra_nlo_threshold_p1) == 0.0)

! tree level result from amp_blob, i.e. with factorized onshell decays
FF = 9 # FF = 1
offshell_strategy = -3
seed = 0
integrate (extra_nlo_threshold_p1)

! and with the nlo command
seed = 0
process extra_nlo_threshold_p2 = e1, E1 => Wp, Wm, b, B {nlo_calculation = "Born"}
integrate (extra_nlo_threshold_p2)

! same numbers but different program flow
expect (integral (extra_nlo_threshold_p1) ==
  integral (extra_nlo_threshold_p2)) {tolerance = 0.0001}

! Now we take the tree level result from amp_tree, i.e. the signal diagram
FF = 10 # FF = 0
offshell_strategy = -1
seed = 0
integrate (extra_nlo_threshold_p1)
! Differences of O(Gamma/M) are ok
printf "wtop   = %g" (wtop)
printf "mtop   = %g" (mtpole)
expect (integral (extra_nlo_threshold_p1) ==
  integral (extra_nlo_threshold_p2)) {tolerance = wtop/mtpole * integral (extra_nlo_threshold_p1)}

!process extra_nlo_threshold_p3 = e1, E1 => Wp, Wm, b, B {nlo_calculation = "Real"}
!integrate (extra_nlo_threshold_p3)

!process extra_nlo_threshold_p4 = e1, E1 => Wp, Wm, b, B {nlo_calculation = "Virtual"}
!integrate (extra_nlo_threshold_p4)

!process extra_nlo_threshold_p5 = e1, E1 => Wp, Wm, b, B {nlo_calculation = "Full"}
!integrate (extra_nlo_threshold_p5)

model = SM
mZ = 91.188
mW = 80.419
mb = 4.2
alphas = 0.118 ! (Z pole, NLL running to mu_h)
GF = 1.2273E-005
mtop = 172.0
wtop = 1.5385601
scale = mtop
$method = "omega"
seed = 0
process extra_nlo_threshold_p6 = e1, E1 => Wp, Wm, b, B {$restrictions = "3+5~t && 4+6~tbar"}
integrate (extra_nlo_threshold_p6)

! Differences come from the precision of the input parameters
expect (integral (extra_nlo_threshold_p1) ==
  integral (extra_nlo_threshold_p6)) {tolerance = 0.001 * integral (extra_nlo_threshold_p1)}
